# BacktestEngine 모듈

## 목적

**팩터 시그널을 실제 투자 성과로 변환**하는 핵심 모듈입니다.

vectorbt를 기반으로 **현실적인 거래 조건**(수수료, 슬리피지, 세금)을 반영한 백테스트를 실행합니다.

---

## 핵심 기능

### 1. 현실적 거래비용 반영

| 비용 항목 | 기본값 | 설명 |
|-----------|--------|------|
| **수수료** | 0.015% | 매수/매도 시 증권사 수수료 |
| **슬리피지** | 0.05% | 주문가와 체결가 차이 |
| **매도세** | 0.23% | 증권거래세 (매도 시) |

### 2. 룩어헤드 방지

**시그널 지연(signal_delay)** 적용:
- 시그널 발생일: Day 0
- 실제 거래일: Day 1 (다음 거래일 시가에 체결)

```
Day 0: 시그널 발생 (매수 신호)
Day 1: 실제 매수 체결  ← 현실 반영
```

### 3. 리밸런싱 주기

| 주기 | 설명 | 용도 |
|------|------|------|
| **DAILY** | 매일 | 단기 트레이딩 |
| **WEEKLY** | 매주 | 중기 전략 |
| **MONTHLY** | 매월 | 장기 투자 |
| **QUARTERLY** | 분기 | 자산배분 |

---

## 백테스트 설정 항목

| 항목 | 기본값 | 설명 |
|------|--------|------|
| `init_cash` | 1억원 | 초기 투자금 |
| `commission` | 0.015% | 거래 수수료 |
| `slippage` | 0.05% | 슬리피지 |
| `tax` | 0.23% | 매도세 |
| `signal_delay` | 1일 | 시그널 지연 |
| `max_positions` | 20 | 최대 보유 종목 수 |

---

## Walk-Forward 테스트

**과적합 검증**을 위한 IS/OOS 분리 테스트:

```
전체 데이터: |----IS----|--OOS--|----IS----|--OOS--|...
              학습기간   검증기간  학습기간   검증기간
```

- **IS (In-Sample)**: 전략 파라미터 학습
- **OOS (Out-of-Sample)**: 실제 성과 검증

---

## 백테스트 결과

| 항목 | 설명 |
|------|------|
| `portfolio` | vectorbt Portfolio 객체 |
| `trades` | 거래 내역 DataFrame |
| `daily_returns` | 일별 수익률 Series |
| `positions` | 포지션 내역 |

---

## 입출력 요약

| 입력 | 출력 |
|------|------|
| 가격 데이터 + 시그널 | BacktestResult |
| 가격 데이터 + FactorCombiner | BacktestResult |

---

## 관련 모듈

- **이전 단계**: [02_factor_interface.md](02_factor_interface.md) - 시그널 생성
- **다음 단계**: [04_metrics.md](04_metrics.md) - 성과 지표 계산
